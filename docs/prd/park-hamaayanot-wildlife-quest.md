# PRD: Park HaMaayanot Wildlife Quest

## Status: APPROVED
## Author: Generated by AI, owned by human
## Date: 2026-02-17

---

## 1. Problem Statement

Park HaMaayanot seeks to enhance visitor engagement by introducing an interactive wildlife-themed treasure hunt. Currently, visitors walk the park without guided interaction or gamified experiences. A digital QR-based scavenger hunt will increase visit duration, educate visitors about local wildlife, and create a memorable family-friendly activity. The park needs a permanent, stable, and admin-manageable digital platform — deployable now to support the upcoming spring season and beyond.

## 2. Target Users

- **Park visitors (families)**: Participants who scan QR codes at physical stations, collect letters, learn about animals, and solve a final puzzle. Primary device: mobile phone. Primary language: Hebrew (RTL).
- **Park staff (prize booth)**: Verify redemption codes at the prize counter to confirm puzzle completion and distribute prizes.
- **Park administrators**: Manage animal content (images, videos, facts, letter mappings), monitor user activity, export reports, and activate/deactivate checkpoints.

## 3. Goals

- Enable visitors to complete a 10-station wildlife QR treasure hunt entirely on their mobile devices
- Educate visitors about local wildlife through short video clips, images, and fun facts at each station
- Provide a puzzle-solving experience where collected letters form a secret word
- Allow prize redemption with a verifiable, unique code upon puzzle completion
- Give administrators full control over content, user monitoring, and data export
- Achieve < 3s first load and < 2s animal page load for smooth outdoor mobile use

## 4. Non-Goals (Explicitly Out of Scope)

- Native mobile app (iOS/Android app store distribution) — PWA only
- Offline-first mode (future enhancement, not V1)
- Multi-language support (Hebrew only for V1; English is future)
- Real-time multiplayer or leaderboard features
- Payment processing or e-commerce
- Push notifications
- Multi-park deployment (architecture should support it, but not implemented in V1)
- Seasonal puzzle variations (future enhancement)
- Heatmap or advanced analytics (basic analytics only in V1)

## 5. User Stories

### US-1: Visitor Registration
**As a** park visitor, **I want** to register with my name, phone, and email, **so that** my game progress is saved and the park can contact me if needed.

**Acceptance Criteria:**
- [ ] AC 1.1: Registration form collects full name, phone number, email, and password
- [ ] AC 1.2: Password is securely hashed (bcrypt) before storage
- [ ] AC 1.3: Duplicate email registration is rejected with a clear Hebrew error message
- [ ] AC 1.4: After registration, user is automatically logged in and redirected to the puzzle hub page
- [ ] AC 1.5: Login form allows returning users to authenticate with email + password

### US-2: Scan QR at Checkpoint
**As a** park visitor, **I want** to scan a QR code at an animal station, **so that** I can unlock that station's content and collect a letter.

**Acceptance Criteria:**
- [ ] AC 2.1: Each QR code contains a unique UUID-based token that maps to a specific animal checkpoint
- [ ] AC 2.2: Scanning a valid QR redirects to the animal checkpoint page (deep link via URL)
- [ ] AC 2.3: If the user is not logged in, they are redirected to login/register first, then back to the checkpoint
- [ ] AC 2.4: Duplicate scans of the same checkpoint show the animal page again but do not duplicate progress
- [ ] AC 2.5: Invalid or tampered QR tokens return a friendly error page in Hebrew

### US-3: View Animal Checkpoint Content
**As a** park visitor, **I want** to see the animal's image, video, and fun facts after scanning, **so that** I learn about the wildlife at this station.

**Acceptance Criteria:**
- [ ] AC 3.1: Animal checkpoint page displays: animal image, short video clip, fun facts text (Hebrew)
- [ ] AC 3.2: A letter reveal animation plays, showing the letter collected at this station
- [ ] AC 3.3: Progress indicator shows X/10 checkpoints completed
- [ ] AC 3.4: Page loads in < 2 seconds on a 4G mobile connection
- [ ] AC 3.5: Video plays inline without leaving the page (no external redirects)

### US-4: Track Progress and Solve Puzzle
**As a** park visitor, **I want** to see my collected letters and empty slots on the puzzle hub page, **so that** I know my progress and can attempt to solve the word.

**Acceptance Criteria:**
- [ ] AC 4.1: Puzzle hub page shows 10 letter slots — filled slots show collected letters, empty slots show placeholders
- [ ] AC 4.2: Progress bar shows percentage of checkpoints completed
- [ ] AC 4.3: Submit button is always visible; server-side validation checks the submitted word
- [ ] AC 4.4: Incorrect submission shows a gentle "Try again" message in Hebrew without penalty
- [ ] AC 4.5: Correct submission triggers a confetti animation and navigates to the redemption screen
- [ ] AC 4.6: Letters are displayed in the correct puzzle order (by order_index), not scan order

### US-5: Redeem Prize
**As a** park visitor, **I want** to receive a unique redemption code after solving the puzzle, **so that** I can claim my prize at the park booth.

**Acceptance Criteria:**
- [ ] AC 5.1: Upon correct puzzle submission, a unique redemption code is generated (alphanumeric, 8 chars)
- [ ] AC 5.2: Redemption screen displays the code as text and as a scannable QR code
- [ ] AC 5.3: Redemption code can only be used once
- [ ] AC 5.4: Redemption screen is accessible from the user's profile/game page after completion

### US-6: Admin User Management
**As a** park administrator, **I want** to view, search, and filter all registered users, **so that** I can monitor participation and support visitors.

**Acceptance Criteria:**
- [ ] AC 6.1: Admin dashboard shows a paginated user list with columns: name, email, phone, status (in-progress/completed), registration date
- [ ] AC 6.2: Filter users by: completion status, date range, time spent
- [ ] AC 6.3: Search users by name or email (partial match)
- [ ] AC 6.4: Click on a user to view detailed progress (which checkpoints scanned, timestamps, letters collected)

### US-7: Admin CSV Export
**As a** park administrator, **I want** to export user data as CSV, **so that** I can analyze participation offline or share reports.

**Acceptance Criteria:**
- [ ] AC 7.1: Export button generates a CSV download
- [ ] AC 7.2: Export supports filters: date range, completion status, all users
- [ ] AC 7.3: CSV includes columns: name, phone, email, completion status, completion date, letters collected

### US-8: Admin Animal Content Management
**As a** park administrator, **I want** to edit animal checkpoint content, **so that** I can update facts, replace videos, change letter mappings, or disable stations.

**Acceptance Criteria:**
- [ ] AC 8.1: Admin can edit fun facts text per animal checkpoint
- [ ] AC 8.2: Admin can upload/replace the video clip per checkpoint
- [ ] AC 8.3: Admin can change the letter mapping and order index per checkpoint
- [ ] AC 8.4: Admin can activate or deactivate a checkpoint (deactivated checkpoints are skipped by the game engine)
- [ ] AC 8.5: Changes take effect immediately without requiring a deployment
- [ ] AC 8.6: Admin can upload/replace the animal image per checkpoint

### US-9: Admin Prize Verification
**As a** park staff member, **I want** to verify a visitor's redemption code, **so that** I can confirm they completed the hunt before giving the prize.

**Acceptance Criteria:**
- [ ] AC 9.1: Admin/staff can enter or scan a redemption code to check validity
- [ ] AC 9.2: Valid unredeemed code shows user name and marks as redeemed on confirmation
- [ ] AC 9.3: Already-redeemed codes show a "previously redeemed" message with timestamp
- [ ] AC 9.4: Invalid codes show a "not found" message

### US-10: Admin Authentication
**As a** park administrator, **I want** to log in with role-based access, **so that** only authorized staff can access the admin console.

**Acceptance Criteria:**
- [ ] AC 10.1: Admin login is via a separate secure route (/admin/login)
- [ ] AC 10.2: Admin accounts are role-based (admin, staff) — staff can only verify prizes; admin has full access
- [ ] AC 10.3: Admin sessions use JWT with expiration
- [ ] AC 10.4: Unauthenticated access to admin routes redirects to admin login

### US-11: Password Reset
**As a** park visitor, **I want** to reset my password if I forget it, **so that** I can regain access to my game progress.

**Acceptance Criteria:**
- [ ] AC 11.1: "Forgot password" link on login page triggers an email with a reset link
- [ ] AC 11.2: Reset link expires after 1 hour
- [ ] AC 11.3: New password must meet minimum security requirements (8+ chars)

### US-12: Basic Analytics Dashboard
**As a** park administrator, **I want** to see basic analytics, **so that** I can understand park engagement.

**Acceptance Criteria:**
- [ ] AC 12.1: Dashboard shows total registered users
- [ ] AC 12.2: Dashboard shows completion rate (% of users who finished the puzzle)
- [ ] AC 12.3: Dashboard shows average time to complete (from first scan to puzzle solve)
- [ ] AC 12.4: Dashboard shows checkpoint scan distribution (which checkpoints are scanned most/least)

## 6. Functional Requirements

### Must Have (P0)

- User registration with full name, phone, email, password (bcrypt hashed)
- User login with JWT session management
- QR code deep linking: UUID-based tokens mapped to animal checkpoints
- Animal checkpoint page with image, video, fun facts, letter reveal animation, progress indicator
- Puzzle hub page with letter slots, progress bar, submit/validate answer (server-side)
- Prize redemption code generation (unique, one-time use) with QR display
- Admin authentication with role-based access (admin, staff)
- Admin user management: list, search, filter, view detail
- Admin prize verification: scan/enter code, mark redeemed
- Admin animal content management: edit facts, replace video, change letter, activate/deactivate
- Hebrew (RTL) primary language throughout
- Mobile-first responsive design with nature/park theme
- HTTPS, rate limiting on QR endpoint, JWT expiration, SQL injection protection

- Letter reveal animation at checkpoints
- Confetti animation on puzzle completion
- Admin route protection (no direct object access — use UUIDs in all URLs)
- Deactivated checkpoint skip logic (game engine skips inactive checkpoints, adjusts total count)

### Should Have (P1)

- Admin CSV export with filters (date range, completion status)
- Password reset via email
- Basic analytics dashboard (total users, completion rate, avg time, checkpoint distribution)

### Nice to Have (P2)

- Email verification on registration
- PWA manifest and service worker for "add to home screen"
- Subtle nature animations (leaf movement, ripple effects) on checkpoint pages

## 7. Acceptance Criteria (Consolidated)

### P0 — Must Pass for Launch
- [ ] AC 1.1: Registration form collects full name, phone, email, password
- [ ] AC 1.2: Password bcrypt hashed
- [ ] AC 1.3: Duplicate email rejected with Hebrew error
- [ ] AC 1.4: Auto-login after registration, redirect to puzzle hub
- [ ] AC 1.5: Login with email + password
- [ ] AC 2.1: QR contains UUID token mapped to checkpoint
- [ ] AC 2.2: Valid QR redirects to animal page
- [ ] AC 2.3: Unauthenticated QR scan redirects to login then back
- [ ] AC 2.4: Duplicate scans show page without duplicating progress
- [ ] AC 2.5: Invalid QR shows friendly Hebrew error
- [ ] AC 3.1: Animal page shows image, video, fun facts
- [ ] AC 3.2: Letter reveal animation on checkpoint
- [ ] AC 3.3: Progress indicator X/10
- [ ] AC 3.4: Animal page < 2s load on 4G
- [ ] AC 3.5: Video plays inline
- [ ] AC 4.1: Puzzle hub shows 10 letter slots (filled + empty)
- [ ] AC 4.2: Progress bar shows completion percentage
- [ ] AC 4.3: Submit button with server-side validation
- [ ] AC 4.4: Incorrect submission shows "try again" in Hebrew
- [ ] AC 4.5: Correct submission triggers confetti → redemption screen
- [ ] AC 4.6: Letters displayed in puzzle order (order_index)
- [ ] AC 5.1: Unique 8-char alphanumeric redemption code generated
- [ ] AC 5.2: Code shown as text + QR
- [ ] AC 5.3: One-time use only
- [ ] AC 5.4: Redemption screen accessible after completion
- [ ] AC 6.1: Admin user list: name, email, phone, status, date
- [ ] AC 6.2: Filters: status, date range, time spent
- [ ] AC 6.3: Search by name/email
- [ ] AC 6.4: Detailed user progress view
- [ ] AC 8.1: Edit fun facts text
- [ ] AC 8.2: Upload/replace video
- [ ] AC 8.3: Change letter + order index
- [ ] AC 8.4: Activate/deactivate checkpoint
- [ ] AC 8.5: Changes effective immediately
- [ ] AC 8.6: Admin can upload/replace animal image
- [ ] AC 9.1: Enter/scan redemption code
- [ ] AC 9.2: Valid code shows user name, marks redeemed
- [ ] AC 9.3: Already-redeemed shows message + timestamp
- [ ] AC 9.4: Invalid code shows "not found"
- [ ] AC 10.1: Admin login at /admin/login
- [ ] AC 10.2: Role-based (admin, staff)
- [ ] AC 10.3: JWT with expiration
- [ ] AC 10.4: Unauthenticated redirect to admin login

### P1 — Should Pass
- [ ] AC 7.1: CSV export download
- [ ] AC 7.2: Export filters: date range, status, all
- [ ] AC 7.3: CSV columns: name, phone, email, status, completion date, letters
- [ ] AC 11.1: Forgot password sends reset email
- [ ] AC 11.2: Reset link expires in 1 hour
- [ ] AC 11.3: New password 8+ chars
- [ ] AC 12.1: Total registered users metric
- [ ] AC 12.2: Completion rate metric
- [ ] AC 12.3: Average completion time metric
- [ ] AC 12.4: Checkpoint scan distribution

### P2 — Nice to Have
- [ ] Email verification on registration
- [ ] PWA manifest + service worker
- [ ] Nature animations (leaf, ripple)

## 8. Non-Functional Requirements

- **Performance**: First load < 3 seconds; animal page load < 2 seconds on 4G mobile. Lazy-load video and images.
- **Security**: HTTPS mandatory. Rate limiting on QR scan endpoint (prevent brute-force token guessing). JWT tokens with 24h expiration (visitors) / 8h (admin). Bcrypt password hashing. Parameterized SQL queries (no string concatenation). Admin routes require valid admin JWT. No direct database object ID exposure in URLs (use UUIDs).
- **Scalability**: Support 300 concurrent users without degradation. Database connection pooling. Cloud hosting with auto-scaling capability.
- **Accessibility**: Large tap zones (min 44x44px). Clear, high-contrast typography. RTL layout throughout. Sans-serif font optimized for mobile reading.
- **Reliability**: Daily automated database backups with 30-day retention. 99.5% uptime target.

## 9. Testing Strategy

| User Story | Unit | Integration | UI | E2E | Notes |
|-----------|------|-------------|-----|-----|-------|
| US-1 (Registration) | Yes | Yes (DB, bcrypt) | Yes (form) | Yes | Critical path — full stack test |
| US-2 (QR Scan) | Yes | Yes (QR→DB lookup) | Yes (redirect) | Yes | UUID validation, auth redirect |
| US-3 (Animal Page) | Yes | Yes (content API) | Yes (media display) | No | Video playback, RTL layout |
| US-4 (Puzzle Hub) | Yes | Yes (progress API) | Yes (slots, submit) | Yes | Server-side validation, confetti |
| US-5 (Redemption) | Yes | Yes (code gen, verify) | Yes (QR display) | Yes | One-time use enforcement |
| US-6 (Admin Users) | Yes | Yes (DB queries) | Yes (table, filters) | No | Pagination, search |
| US-7 (CSV Export) | Yes | Yes (DB→CSV) | Yes (download) | No | Filter combinations |
| US-8 (Content Mgmt) | Yes | Yes (file upload, DB) | Yes (forms) | No | Immediate effect validation |
| US-9 (Prize Verify) | Yes | Yes (code lookup) | Yes (scan/enter) | Yes | Already-redeemed handling |
| US-10 (Admin Auth) | Yes | Yes (JWT, roles) | Yes (login) | Yes | Role-based route protection |
| US-11 (Password Reset) | Yes | Yes (email, token) | Yes (form) | No | Token expiration |
| US-12 (Analytics) | Yes | Yes (aggregate queries) | Yes (charts) | No | Data accuracy |

## 10. Technical Context & Constraints

- **Frontend**: Next.js with React, Tailwind CSS, PWA-enabled. Mobile-first responsive. Hebrew RTL primary.
- **Backend**: Node.js (Express or NestJS) or Supabase for backend services. REST API. JWT auth.
- **Database**: PostgreSQL (managed cloud — Supabase or Railway). Relational schema with tables: users, animals, user_progress, redemptions, admins.
- **Hosting**: Vercel (frontend), Supabase/Railway/Render (backend + DB).
- **Storage**: Cloud storage (Supabase Storage or S3-compatible) for animal images and video clips.
- **QR Codes**: Physically printed and installed at 10 park stations. Each contains a URL with a UUID token: `https://<domain>/scan/<uuid>`.
- **Design System**: Nature theme — deep green (#2F5D50), water turquoise (#4DB6AC), sand beige (#E8D8B9), soft sky blue (#B3E5FC). Sans-serif typography. Large headings.
- **Environments**: Dev, Staging, Production. Git-based CI/CD with environment variables secured.
- **Constraint**: System must work reliably on budget Android phones with 4G connectivity in an outdoor park setting.

## 11. Success Metrics

| Metric | Target | Measurement Method |
|--------|--------|--------------------|
| Game completion rate | > 60% of registered users complete puzzle | DB query: completed / total users |
| Average completion time | < 90 minutes | DB: avg(last_scan - first_scan) for completed users |
| First page load | < 3 seconds (p95) | Performance monitoring (Vercel Analytics) |
| Animal page load | < 2 seconds (p95) | Performance monitoring |
| Daily active users | > 50 during peak season | DB query: unique users with scans per day |
| Admin adoption | Park staff uses dashboard weekly | Admin login frequency tracking |
| System uptime | 99.5% | Hosting provider monitoring |

## 12. Open Questions

- [ ] What is the secret word for the puzzle? (Needs park management input to define the 10 letters)
- [ ] Which 10 animals will be featured? (Needs park management input for animal selection + facts)
- [ ] Will email verification be required at launch or deferred? (Recommendation: defer to P2)
- [ ] What is the prize being offered? (Affects redemption screen copy)
- [ ] Should the game have a time limit per visit? (Recommendation: no limit for V1)
- [ ] Exact domain name for the platform? (Needed for QR code printing)
- [ ] Supabase vs. separate Express/NestJS backend? (Recommendation: Supabase for faster development + integrated auth/storage/DB)

## 13. Dependencies & Risks

| Risk | Impact | Likelihood | Mitigation |
|------|--------|------------|------------|
| Poor mobile connectivity in park areas | High | Medium | Optimize assets (compress images/video), lazy loading, consider PWA caching in future |
| QR codes damaged by weather | Medium | Medium | Laminated/weatherproof printing, admin can regenerate QR tokens |
| Users abandoning mid-hunt | Medium | High | Progress saves automatically, users can resume anytime with login |
| Budget Android phones with low memory | Medium | Medium | Lightweight pages, minimal JS, optimized media |
| Peak season traffic spikes (300+ concurrent) | Medium | Low | Cloud auto-scaling, CDN for static assets, DB connection pooling |
| Admin content changes breaking game state | High | Low | Validate changes (prevent removing letters from active games), soft-delete pattern |
| QR token brute-force attempts | Low | Low | Rate limiting on scan endpoint (10 req/min per IP), UUID v4 entropy makes guessing infeasible |

## 14. Timeline Estimate

- **Phase 1 (Week 1-2)**: Project setup, DB schema, authentication (user + admin), basic API structure
- **Phase 2 (Week 2-3)**: Game engine — QR scanning, animal checkpoint pages, progress tracking, letter collection
- **Phase 3 (Week 3-4)**: Puzzle hub, word validation, prize redemption system
- **Phase 4 (Week 4-5)**: Admin console — user management, content management, prize verification, CSV export
- **Phase 5 (Week 5-6)**: Analytics dashboard, design polish, nature theme, animations, RTL refinement
- **Phase 6 (Week 6-7)**: Testing, performance optimization, security hardening, staging deployment
- **Phase 7 (Week 7-8)**: UAT with park staff, QR code printing, production deployment, go-live

## Pipeline Status
- **Stage:** PRD GENERATION (Stage 1 of 4)
- **Started:** 2026-02-17
- **PRD:** docs/prd/park-hamaayanot-wildlife-quest.md (current)
